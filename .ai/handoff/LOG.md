# AAHP: Agent Journal

> **Append-only.** Never delete or edit past entries.
> Every agent session adds a new entry at the top.
> This file is the immutable history of decisions and work done.

---

## [2026-02-26] Claude Opus 4.6: Complete T-003, T-004, T-005 -CI, CLI, Tests

**Agent:** Claude Opus 4.6
**Phase:** 3 (Implementer)
**Branch:** main
**Tasks:** T-003, T-004, T-005

### What was done

- **T-003**: Created `.github/workflows/ci.yml` -GitHub Actions CI pipeline with shellcheck, lint-handoff.sh, and ajv schema validation
- **T-004**: Created `bin/aahp.js` + `package.json` -npx-distributable CLI with subcommands: init, manifest, lint, migrate. Pure Node.js, no dependencies. ESM module.
- **T-005**: Created 48 bats tests across 3 suites: `tests/manifest.bats` (18), `tests/lint.bats` (18), `tests/migrate.bats` (12). All passing. Cross-platform temp dir handling for Windows Git Bash.
- Fixed `lint-handoff.sh` Python detection: Windows `python3` Store alias passes `command -v` but doesn't work; now tries actual invocation before trusting
- Fixed Unicode encoding in Python checksum output (cp1252 on Windows)
- Updated README.md: title "AAHP v2 Proposal" â†’ "AAHP: AI-to-AI Handoff Protocol (v2/v3)", version refs, agent names
- Added `bats` as devDependency for local test running
- Created `tests/run.sh` convenience runner
- Created `tests/test_helper.bash` shared test fixtures
- All 48 tests pass, CLI verified, lint passes

### Decisions made

- CLI uses ESM (`"type": "module"`) with zero external dependencies -only Node.js built-ins
- `aahp init` implemented in pure Node.js (file copy), other commands spawn bash scripts
- bats-core via npm (`npx bats`) rather than system install
- Tests create isolated temp fixtures -no dependency on project's own `.ai/handoff/`
- New follow-up tasks created: T-006 (npm publish), T-007 (shellcheck fixes), T-008 (bats in CI)

---

## [2026-02-26] Claude Opus 4.6: AAHP v3 -Task IDs & Dependency Graphs

**Agent:** Claude Opus 4.6
**Phase:** 3 (Implementer)
**Branch:** main
**Tasks:** T-001, T-002

### What was done

- Extended `schema/aahp-manifest.schema.json` with optional `tasks` and `next_task_id` fields
- Defined task ID format: `T-001`, `T-002`, etc. (stable, never reused, zero-padded)
- Added dependency graph structure to MANIFEST.json (`depends_on` array per task)
- Updated `templates/MANIFEST.json` with example task entries
- Updated `templates/NEXT_ACTIONS.md` with `T-xxx:` heading format
- Updated `templates/DASHBOARD.md` with `ID` column in tasks table
- Updated `scripts/aahp-manifest.sh` to preserve `tasks` and `next_task_id` on regeneration (uses Node.js for JSON parsing)
- Added README.md Section 8: full v3 specification (task IDs, schema, agent algorithm, backward compat)
- Dogfooded v3 on AAHP's own `.ai/handoff/` files with 5 tasks (T-001 through T-005)

### Decisions made

- Task IDs use `T-xxx` format (short, readable, sortable) over `AAHP-xxx` (too project-specific)
- Dependency graph lives in MANIFEST.json (structured data) not in Markdown (human text)
- `tasks` and `next_task_id` are optional -v2 projects continue to work without them
- `aahp-manifest.sh` preserves task data using Node.js JSON parsing (available on most systems)
- `aahp_version` bumped to `"3.0"` in generated manifests

---

## [2026-02-26] Claude Opus 4.6: Resolve Open Questions & Dogfood Protocol

**Agent:** Claude Opus 4.6
**Phase:** 3 (Implementer)
**Branch:** main

### What was done

- Resolved all 4 open questions from README.md Section 7
- Created `scripts/_aahp-lib.sh` (shared function library with portable SHA-256, mtime, token estimation)
- Created `scripts/aahp-manifest.sh` (standalone manifest generator with --agent, --phase, --context CLI options)
- Refactored `scripts/aahp-migrate-v2.sh` to source shared lib and delegate manifest generation
- Extended `scripts/lint-handoff.sh` with Check 6: parallel agent detection across git branches
- Replaced README.md Section 7 "Open Questions" with "Resolved Decisions"
- Bootstrapped `.ai/handoff/` for the AAHP project itself (dogfooding)

### Decisions made

- Q1: MANIFEST.json is auto-generated by outgoing agent + CLI tool
- Q2: Whole-file SHA-256 checksums (already implemented, doc-only update)
- Q3: Branch-based isolation for parallel agents, advisory lint warning
- Q4: Dependency graphs deferred to v3
- Extracted shared functions into `_aahp-lib.sh` instead of duplicating between scripts
- Used standalone `aahp-manifest.sh` rather than a unified `aahp.sh` CLI (keeps toolbox pattern)

---

## [2026-02-26] Claude Opus 4.6: Merge v2 Proposal into README

**Agent:** Claude Opus 4.6
**Phase:** 3 (Implementer)
**Branch:** main

### What was done

- Deleted `AAHP-v2-PROPOSAL.md` (content was identical to README.md)
- Updated `scripts/aahp-migrate-v2.sh` references from `AAHP-v2-PROPOSAL.md` to `README.md`
- Committed and pushed to GitHub (commit 672be62)

### Decisions made

- Single source of truth: README.md is the v2 specification document

---

## [2026-02-26] Previous: AAHP v2 Tooling Implementation

**Agent:** (prior session)
**Phase:** 3 (Implementer)
**Branch:** main

### What was done

- Created all 10 template files in `templates/`
- Created `scripts/aahp-migrate-v2.sh` (v1 to v2 migration)
- Created `scripts/lint-handoff.sh` (5 validation checks)
- Created `schema/aahp-manifest.schema.json` (JSON Schema Draft 2020-12)
- Created `AAHP-v2-PROPOSAL.md` with full v2 specification
- Set up LICENSE (now CC BY 4.0, originally MIT), .gitignore

### Decisions made

- Bash-only tooling (no Node.js/Python dependency for core scripts)
- JSON Schema Draft 2020-12 for manifest validation
- Pre-commit hook pattern for safety linting
